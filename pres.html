<!doctype html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Linear algebra is just evoluted duck typing</title>

    <meta name="author" content="Julien Tayon"/>

    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />

    <link href="css/pres.css" rel="stylesheet" />
    <link href="css/jquery-ui.css" media=screen rel="stylesheet" />
    <link href="css/cv.css" rel="stylesheet" />
    <link rel="shortcut icon" href="favicon.png" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
  </head>

  <body class="impress-not-supported">
    <div class=loading ><img src=img/loading.gif /> </div>
    <div class="fallback-message">
      <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
      <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
    </div>
    <div id="impress">
      <div id="init" style="line-height:1.4em;" class="step" data-scale=6 data-x="00" data-y="00" >
          <center>    <a href=https://fosdem.org/2017/schedule/event/python_duck_typing/><b>FOSDEM'</b>17</a><br/>

        The power of duck typing and linear algrebra
        <br/></center>
        <pre class=vi>

    Track: Python devroom
    Room: H.1308 (Rolin)
    Day: Saturday
    Start: 11:30
    End: 12:00
        </pre>

        <ul>
          <li><a  href="#CVinter">I wanna puke visualisation</a></li>
          <li><a id=jcprt href="#printable">Printable one</a></li>
        </ul>
      </div>
      <div id="CVinter" class="content step " data-scale=1 data-x="1500" data-y="00" data-rotate=45  >
        All great story begins with a book! And too much free time<br/>
        <h1 class=big >Part1: The magic of algebra</h1>
          It's all about behaviours<br/>
          Legal discolusure: My linear algebra books is the french version of<br/>
          <a href=http://www.goodreads.com/book/show/205506.Schaum_s_Outline_of_Linear_Algebra>
            Lipschutz Linear Algebra (Shaum edition)</a>
     
     </div>
      <div class="content step " data-scale=2 data-x="2000" data-y="2000" data-rotate=90 >
	
	   <h1 class=big >Linear algebra 101:</h1>
        <p>
        If you behave nicely and consistently you have super cow powers including
        <ul>
          <li>metrics
          </li>
          <li>distributive systems, paralellism
          </li>
          <li>least surprises
          </li>
        </ul>
      </div>
      <div  class="content step"   data-scale=1 data-x="1000" data-y="2000"
        data-rotate=90  >
	<h1 class=big><b>Theorem 1: given simple enough rules you can make TDD</b></h1>
	Linear algebra definition is basically if you pass the tests, then you have super powers.
	<img src=img/theorem1.png >
	Nota Bene:
	<ul>
	  <li>
	    1 is NOT 1, and so 0 is not 0. They are symbol that does the job</li>
	  <li>Computer int are no integer, floats are not real numbers, and all is lies</li>
	  <li>Good enough lies worth a good enough truth</li>
	</ul>

      </div>

      <div  class="content step"   data-scale=1 data-x="00" data-y="2000" 
         data-rotate=120
          >
	<h1 class=big>Step 0: Writing you own test frameworks</h1>
	<p>
	Doesn't it look like the exact perfect match case of a unit test?<br/>
	<a href=https://github.com/jul/ADictAdd_iction/blob/master/vector_dict/ConsistentAlgebrae.py#L168-L198 >
	  Consistent Algebra test</a>
	<img src=img/screenal1.png />
	</p>
      </div>

      <div  class="step content"  data-scale=.8 data-x="-700" data-y="2000" 
          data-rotate=150
      >
       <h1 class=big>Which makes you curious of what is compliant by default</h1>
       (yes I purposefully did not went on edge cases)

       <pre style='font-size:60%'>
**************************************************
testing for  'complex' class
 a = (1+0j)
 b = (1+1j)
 c = (1-4j)
 an_int = 2 
 other_scalar = 3 
 neutral element for addition is 0j 

**************************************************

test #1
 a + b = b + a 
'test_commutativity' is 'ok'

test #2
 a + neutral = a 
'test_neutral' is 'ok'

... other tests ....

test #12
 an_int ( a + b) = an_int *a + an_int * b 
'test_distributivity' is 'ok'

**************************************************

14/14
&lt;type 'complex'&gt; respects the linear algebrae standard rules 

**************************************************
       </pre>

	</div>

	<div  class="content step"   data-scale=.5 data-x="-1000" data-y="2500"
            data-rotate=180
            >
	  <h1 class=big><b>Just for fun what default type can be considered scalars? </b></h1>
	  <center>
	  <table class=res>
	    <thead>
	      <tr>
		<th>Type</th>
		<th>Neutral of add.</th>
		<th>Neutral of mul.</th>
		<th>Result</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr>
		<td>
		  Numpy array
		</td>
		<td>
		  zeroes(dim)
		</td>
		<td>
		  ones(dim)
		</td>
		<td class=cok >
		  OK
		</td>
	      </tr>
	      <tr>
		<td>
		  floats
		</td>
		<td>
		  0.0
		</td>
		<td>
		  1.0
		</td>
		<td class=cok >
		  OK
		</td>
	      </tr>
	      <tr>
		<td>
		  int
		</td>
		<td>
		  0	
		</td>
		<td>
		  1
		</td>
		<td class=cok >
		  OK
		</td>
	      </tr>
	      <tr>
		<td>
		  Decimal
		</td>
		<td>
		  Decimal(0.000000)
		</td>
		<td>
		  Decimal(1.000000)
		</td>
		<td class=cko >
		  KO
		</td>
	      </tr>
	      <tr>
		<td>
		  complex
		</td>
		<td>
		  0+0j
		</td>
		<td>
		  1+0j
		</td>
		<td class=cok >
		  OK
		</td>
	      </tr>
	      <tr>
		<td>
		  list
		</td>
		<td>
		  [ ]
		</td>
		<td>
		  1
		</td>
		<td class=cko >
		  KO
		</td>
	      </tr>

	    </tbody>
	  </table>
	  </center>
	  You can also test strings, quaternions....
       <p class=exergue>Yes, math rox, you are free to code whatever you want and you don't
           have to justify youself, as long as you pass the tests</p>
           <br>
           <p><i>Note for coconut user that want algebraic data types: python
               &amp; numpy already  provide some naturally algebraic data type</i>
           <br>
           <p><i>Note to R users: if you search for optimized list à la R in python go directly for numpy arrays</i></p>

	</div>
	<div  class="content step"   data-scale=1 data-x="-2000" data-y="2000"
          data-rotate=220
            >

  <h1 class=big><b>Let's make a simple observation</b></h1>
  <p>
        On a MutableMapping anything that is not a leaf is a part of a key.<br/>
        But let's turn<br>
        <code>{ 'a': { 'b' : 1 }, 'b' : 2}</code>
        AS<br>
        <code> { ('a', 'b') : 1; 'b': 2 }</code><br>
        All keys are immutable. So the tuple of the keys is also...immutable.<br/> 
        Hence:
        <p class=exergue>Every distinct immutables path to a value are a key, and 
        then we can reduce a recursive problem to a 1 level problem.<br/>
        All MutableMapping are utimately possibly put in a canonical one level form.<br/>
        Every distinct immutable paths to a value are equivalent to a dimension.<br/>
        We have an isomorphism between the one level MutableMapping and arbitrary depth MutableMappings.
        </p>
        <br>

        We transformed a recursive/deep level problem in a one depth problem.

</p>
	</div>
        <div  class="step content" data-scale=1.2
       data-x="-1000"  data-y="3000"
      data-rotate=250
       >

          <h1 class=big><b>Math books then gives you the Cook book</b></h1>
          <img src=img/somprod_vect.png />



</div>
        <div class="content step" data-scale=1 data-x="00" data-y="3000" 
                                              data-rotate=280 >


       <h1 class=big><b>Part 2: making dict follow linear algebra behaviour</b></h1>
       <p>
                 Arbitrary choices:
<ul>
<li>
        I overload
        <ul>
    <li> + (<span class=Identifier>___add__,__radd__, __iadd__</span>) </li>
<li> - (<span class=Identifier>___sub__, __rsub__, __isub__</span>) </li>
<li> * (<span class=Identifier>___mul__, __rmul__, __imul__</span>) </li>
<li> / (<span class=Identifier>___div__, __rdiv__, __idiv__</span>) </li>
</ul>
    and if a left and right are mutable mapping <i>aka dict</i>, I propagate as long as both left/right operantd match key path to a leaf

</li>
<li>I made junction of relationships such as defining <span class=Identifier>__neg__</span> (unary -) as <pre class=vi>__neg__ = lambda self: self*=-1</pre> to ensure consistency
</li>
</ul>
Abstract base class (<i>type</i>) and duck typing (using the <i>operator</i>) are the only 2 tricks used.
<br/>
   </p>
<p class=exergue><b>
The exact same trick can probably be implemented with C++ STL, in ruby, Perl, PHP, javascript...
</b></p>


        </div>
    <div  class="step  content " data-scale=1 data-x="-500" data-y="3000"
     data-rotate=310
        >
                                              <h1 class=big>Part 3: And? Does it pass the tests?</h1>
At least for the simple case...
<pre class=vi>
**************************************************

testing for  <span class=LIdentifier>'Daikyu'</span> class

a = {'one_and_two': 3, 'one': 1}
b = {'two': 2, 'one_and_two': -1}
c = {'one': 3, 'three': 1, 'two': 2}
an_int = 2 
other_scalar = 3
neutral element for addition is {} 

**************************************************
... 16 tests later ...
**************************************************

16/16
<class 'archery.bow.Daikyu'> respects the linear algebrae standard rules 

**************************************************
</pre>


<span class=crazy >Yes!!!</span><br/><br/><br/>
We have a one level dict behaving as a vector...

    </div>
    <div  class="step  content " data-scale=.9 data-x="-2500" data-y="3000"   
     data-rotate=310
     >


        <h1 class=big >Part 4: Let's use the isomorphism to make intricate dict into vector<br/>
        let's implement, cos, dot
        </h1>
        <pre class=vi>
<span class="PreProc">from</span> collections <span class="PreProc">import</span> MutableMapping

MARKER=<span class="Identifier">object</span>()

<span class="Statement">def</span> <span class="LIdentifier">paired_row_iter</span>(tree, path=MARKER):
    <span class="Statement">if</span> path <span class="Statement">is</span> MARKER:
        path = <span class="Identifier">tuple</span>()

    <span class="Statement">for</span> k, v <span class="Statement">in</span> tree.iteritems():
        <span class="Statement">if</span> <span class="Identifier">isinstance</span>(v, MutableMapping) <span class="Statement">and</span> <span class="Identifier">len</span>(v):
            <span class="Statement">for</span> child <span class="Statement">in</span> <span class=LIdentifier >paired_row_iter</span>(v, path + (k,)):
                <span class="Statement">yield</span> child
        <span class="Statement">else</span>:
            <span class="Statement">yield</span> ((path + (k,)) , v)

<span class=Identifier >dict</span>(<span class=LIdentifier >paired_row_iter</span>({ 'a' : { 'b' :1},  'c':2, 'd' : {'e': []}, 'e': {} }) )
<span class=Comment># {('a', 'b'): 1, ('c',): 2, ('d', 'e'): [], ('e',): {}}</span>

</pre>
</div>
<div class="step content" data-scale=1   data-x="-2500" data-y="2500" 
    data-rotate=350
    >
<h1 class=big ><b>let's read the specs of the dot product</b></h1>
    <img src=./img/dot_prod.png />


</div>
<div  class="step  content " data-scale=.9 data-x="-1500" data-y="2500" 
  data-rotate=380  >

    <h1 class=big>Let's implelement them</h1>
NB: Purists want measure <i>u</i>.<i>u</i> to be
<ul>
    <li>defined</li>
    <li>normed</li>
    <li>positive</li>
</ul>
to fit with the Lebesgue measure. <br/>
My <i>distance</i> however does yield a <span class=Identifier>complex</span>, if scalars are <span class=Identifier>complex</span>.
            <pre class=vi>
dot = lambda u,v: sum(v for i,v in paired_row_iter(u*v))

dot(mdict(x=1,y=1, z=1), mdict(x=1, y=1, z=1))
# 3
dot(mdict(x=1,), mdict( y=1, z=1))
# 0
dot(mdict(x=1,), mdict(x=-1, y=1, z=1))
# -1 
</pre>
For int and real, the resutls are following expectation. 
<br/>
For complex, I am pretty clueless if it is <i>normal</i>.
<br>

</div>
<div class="step" data-scale=1 data-x=-1500 data-y=3000
    data-rotate=360>

    <h1 class=big>Please stop the roto-zoom slides</h1>
    Yes I noticed the persons on the last row being sea sick.<br/>
    Social experiment #154 over: roto-zoom presentation make people 
    uncomfortable. Lol
</div>

<div class="content step" data-scale=1 data-x="-000" data-y="3000" 
                                                data-rotate=360 >

<h1 class=big>Dot product is one step away from distance</h1>
<img src=img/distance.png />
Now we can define <i>abs</i> (which is a mathemtic shortcut for L2 distance/norm) and distance as 
<pre class=vi>
vabs = lambda v: dot(v,v)**.5
distance = lambda u, v: vabs(u-v)
</pre>

<small>I disagree with Lipschutz I think Ln norms should be taken for dimension n

$$ \left\| x \right\| _p = \bigg( \sum_{ i \in \mathbb N} \left| x_i \right| ^p \bigg) ^{1/p}$$
<br>
Where p = the dimension of your base.
</small>



</div>
  <div class="content step" data-scale=1.2
data-rotate=360 data-x="-000" data-y="4000">

    <h1 class=big>And not far from the ... cosinus</h1>
    <small>(math pun are a sine)</small>
    <img src=img/cos.png />
<pre class=vi>
vcos = lambda u,v : dot(u,v) / vabs(u) / vabs(v)

vcos(mdict(x=1, y=1), mdict(x=1, y=0))
<span class=Comment># Out[27]: 0.7071067811865475</span>

2**.5/2
<span class=Comment># Out[29]: 0.7071067811865476 (cos(45°)</span>

vcos(mdict(x=1, ), mdict(x=2, y=4, z=4, v=4))
<span class=Comment># Out[30]: 0.3333333333333333  (cos 60°)</span>

vcos(mdict(x=1), mdict())
<span class=Comment style='color:red'># ZeroDivisionError: float division by zero</span>
</pre>
So far so good.<br/>
<p class=exergue>
We have something that is built for infinite intricated dimensions, and
that already works for the 2D &amp; 3D euclidean space without even trying.<br/>
<a href=http://math.stackexchange.com/a/932454>And we even have a meaningful exception: cos with a null vector does not mean a thing.</a>

</p>


</div>
<div class=step data-rotate=360 data-x=1000 data-y=4000 data-scale=.1>
    <h1 class=big>Please stop the abuse of zoom and random direction</h1>
    Gosh :) Sorry
</div>

<div class="content step" data-scale=1
    data-rotate=360 data-x="1500" data-y="4000"
    >

  <h1 class=big >But does it have the promised behaviour?</h1>
    Let's check.<br/>
    Can we mathematically expose an API that following the least surprise principle:
    <ul>
        <li>for computers? (checked)</li>
        <li>for coders? (it works for me)</li>
        <li>actual mathematical use? (...)</li>
    </ul>
    Especially, is it useful?<br/>
    intuitive? <br/>
    working correctly?<br/>


</div>

      <div class="content step" data-scale=1
    data-rotate=360 data-x="1500" data-y="3000">

    <h1 class=big><b>Let's watch the behaviour of more complex data</b></h1>
    Time to switch to ipython notebook \o/
    


</div>

<div class="content step" data-scale=1
    data-rotate=360 data-x="2500" data-y="3000">

<center>
    <iframe style="display:block;margin:0 auto;" width=1280 height=800  src=FOSDEM.html></iframe>
<center>


</div>

<div
    class="step content " 
    data-rotate=360 data-x="3500" data-y="4000">



<h1 class=big>Use case?</h1>
<ul>
<li>
Text indexation
</li>
<li>
aggregating log parsing (cf <a href=https://github.com/jul/yahi>yahi on github</a>).<br/>
Or simply pypi-stats<br/>Better known as pypi-ranking (for which I am not credited, bouhouh)<br>
</li>
<li>
dict manipulations and measurement
</li>
</ul>
<img src=img/stat.png width=60% />
<img src=img/ranking.png width=60% />
    
   
    



</div>




<div class="step content " 
    data-rotate=270 data-x="4000" data-y="3000">
<h1 class=big>An orthogonal rant on OOP introduction with the 2D point class</h1>
<small>(oh! a geometrical joke)</small><br/>
Complex type does EVERYTHING better than any 2D class I saw! <br>
Maths are powerful, use them: <a href=https://gist.github.com/jul/200d3a5895a437e20df6>check here</a>
<br/>
python3 documentation has reduced considerably the Point 
example in the <a href=https://docs.python.org/3/library/collections.html> collections doc</a>
<br/>
I cannot say how much I consider the 2D class Point as misleading as <i>Hello world</i>

</div>

<div
    class="step content " 
    data-rotate=270 data-x="3500" data-y="3000">
    <h1 class=big>Parellism you said?</h1>
    <small>(Another geometrical joke)</small>
    <p>
        Our data job often? take a dict (like after we parse a log line, or cvs) and 
        aggregating the data in a dict.
    </p>
    <pre class=vi>
log_line = mdict( ip = "127.0.0.1", user_agent = "moz", country="BE",
url="/toto" )
data = mdict( by_country = mdict( GR=12, CA=10), user_agent=mdidct(chrome=1,  ie=1000,))
data["user_agent"] += log_line * mdict( user_agent = 1)
        
    </pre>
    What if we don't have a dict, but just a MutableMapping that directs __getitem__ and __setitem__ to a distant instance? <br/>

    <br/>
</div>
<div
    class="step content " 
    data-rotate=270 data-x="3500" data-y="2000">
    <h1 class=big>Should I use your library?</h1>
    <ul>
        <li>migration to py3 stopped since 3 years (unexpected events occured)</li>
        <li>It works for me(c)</li>
        <li>the naming is awfull and what was indentend as puns is a pain</li>
        <li>for dimension greater than 3 results are consistent</li>
        <li>I did it alone, there is no great mind that can grant this is correct </li>
        <li>Some bugs corrected during presentation not yet pushed to archery (v0.2)</li>
    </ul>
    <a href=http://pythonhosted.org/VectorDict/vector.html#exemples>VectorDict</a> is used O_o (I still have to push a pull request in pypi). I DO NOT recommend it, except for seeing the features I was initially encompassing.
    <br/>
    <a href=http://archery.readthedocs.io/en/latest/index.html>Archery</a> implementing the mixin separately at my opinion is quite mature. BUT, I have trust issues, because I lack of feedback.<br/>
    I hate the naming and how I pedantically <i>javafied</i> the module layout.
    <br/>
    I strongly advise to see this code as an academic work and a proof of concept that is delivered <i>AS IS</i>

</div>
<div
    class="step content " 
    data-rotate=270 data-x="3500" data-y="1000">
    <h1 class=big>Other mad scientist project with Mappings?</h1>

    <ul>
        <li><a href=http://pythonhosted.org/VectorDict/matrix.html>generic sparse matrices for transforming dict in dict</a></li>
        <li><a href=http://pythonhosted.org/VectorDict/vector.html#selecting-item-in-a-tree> traversal and exploration of dict in jquery fashion</a></li>
        <li>other algebra (Rieman, Hibertian) and try to bring
        different algebra for different keys</li>
        <li>defining generic algebra to measure distances other cos, other
        norms...</li>
        <li><a href=https://closeto.readthedocs.io/en/latest/definitions.html>closeto operator</a> aka using duck typing and geometry to <i>type</i> data in algebra that are consistant</li>
        <li><a href=http://pythonhosted.org/VectorDict/vector.html#set-operations> Implementing a Karnaugh/set consistent algebra in forms of mixin for MutableMapping (__or__, __and__, __not__, __xor__ ...)</a></li>
    </ul>
</div>
<div
    class="step content " 
    data-rotate=270 data-x="3500" data-y="000">
    <h1 class=big>And have you tried proposing to python-ideas?</h1>
    Lol<br>
    I tried.
    <ul>
        <li>Not a great communicator</li>
        <li>Too dyslexic to write a PEP</li>
        <li>I don't really like to evangelize</li>
        <li>No published paper and no fame make it hard to have a credibility I guess</li>
    </ul>
    </div>
<div
    class="step content " 
    data-rotate=270 data-x="3500" data-y="-1000">
<center>    <img src=img/thatsall.gif ><br></center>
    <h1 class=big >Thanks to:</h1>      
        <ul>
        <li>
        Stéphane Wirtel, and FOSDEM team
        </li>
        <li>
        Pierre Parisot (who taught me everything @IBM ECAM) on text indexation,
        </li>
        <li>
        <span class=crazy>YOU!</span>All the great coders that make FOSS fun!
        </li>
        <li>
        <a href=http://twitter.com/bartaz />@bartaz</a> the author of impressjs used for this pres
        </li>
        <li>
        <a href=http://www.mheducation.com/about.html >Mc Graw Hill edition</a> without which I would never have access to cheap non pedantic books during my studies (okay, I should also include <a href=http://www.oreilly.com/ >O'Reilly</a>)
        </li>
        </ul>
    </div>


</div>
    <div id=printable >
      <center><a href="#/init" class=button >
	  version  interactive
	</a></center><br/>
	  <a class=coord href=mailto:julien@tayon.net >Julien@tayon.net</a><br/>
	  <a class=coord href=http://github.com/jul >github.com/jul</a><br/>
	</div>
    </div>
  </div>

    <div class="hint">
      <p>Use a spacebar or arrow keys to navigate</p>
    </div>


    <!--

      Last, but not least.

      To make all described above really work, you need to include impress.js in the page.
      I strongly encourage to minify it first.

      In here I just include full source of the script to make it more readable.

      You also need to call a `impress().init()` function to initialize impress.js presentation.
      And you should do it in the end of your document. Not only because it's a good practice, but also
      because it should be done when the whole document is ready.
      Of course you can wrap it in any kind of "DOM ready" event, but I was too lazy to do so ;)

    -->
    <script src="js/impress.js"></script>
    <script src="js/jquery-1.8.2.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/startup.js"> </script>

  </body>
</html>
